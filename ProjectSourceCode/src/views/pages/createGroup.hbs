{{> header}}
<form id="createGroupForm">
    <div>
        <input type="text" id="groupName" placeholder="Group Name..." required>
        <button id="confirmNameButton">Confirm Name</button>
    </div>
    <div>
        <input type="text" id="search" placeholder="Add friends to group..." disabled>
        <button id="addUserButton" disabled>Add User</button>
    </div>
    <div>
         <ul id="groupMembers"></ul>
    </div>
    <button type="submit" id ="createGroupButton" disabled>Create Group</button>
</form>

{{> footer}}
<script>
$(document).ready(function(){
    let usersToAdd = [];
    // Enable the rest of the form when the confirmNameButton is clicked and the groupName field is not empty
    document.querySelector('#confirmNameButton').addEventListener('click', function() {
        event.preventDefault();
        const groupName = document.querySelector('#groupName').value;
        fetch('/createGroup', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({
            group_name: groupName
            })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            // If the group is successfully created, enable the rest of the form
            if (data.status === 200) {
                document.querySelector('#search').disabled = false;
                document.querySelector('#addUserButton').disabled = false;
                document.querySelector('#createGroupForm button[type="submit"]').disabled = false;
                document.querySelector('#confirmNameButton').disabled = true;
            }
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    });
});
    $("#search").on("input", function(){
        const searchQuery = $(this).val();
        $.ajax({
            url: "/searchFriends?q=" + searchQuery,
            type: "GET",
            success: function(data) {
                // clear the friend list
                $("#search").empty()");
            },
            error: function(error) {
                console.log(error);
            }
        });
    });
document.getElementById("#addUserButton").addEventListener("click", function() {
    event.preventDefault();
    const username = document.getElementById("#search").value;
    const groupName = document.getElementById("#groupName").value;
    fetch('/addUserToGroup', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ username, groupName }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "success") {
            alert(`${username} was added to group ${groupName} successfully`);

            // Create a new list item with the username and append it to the list
            const listItem = document.createElement("li");
            listItem.textContent = username;
            document.getElementById("#groupMembers").appendChild(listItem);

            // Clear the form fields
            document.getElementById("#search").value = "";
            document.getElementById("#groupName").value = "";
        } else {
            alert(data.message);
        }
    })
    .catch((error) => {
        console.error('Error:', error);
    });
});
/*    $("#createGroupForm").on("submit", function(e) {
        e.preventDefault();

        // Add your group creation logic here
        if($("#groupName").val() === "") {
            alert("Group name cannot be empty");
            return;
        }
        else if(usersToAdd.length === 0) {
            alert("Group must have at least one member");
            return;
        }
        else if (usersToAdd.length > 25) {
            alert("Group cannot have more than 25 members");
            return;
        }
        else {
            // Create the group and add all users from the usersToAdd array
            $.ajax({
                url: "/createGroup",
                type: "POST",
                data: { groupName: $("#groupName").val(), users: usersToAdd },
                success: function(response) {
                    if (response.success) {
                        alert("Group created successfully");
                        // Clear the usersToAdd array
                        usersToAdd = [];
                    } else {
                        alert(response.message);
                    }
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }
    }); 
*/
</script>
